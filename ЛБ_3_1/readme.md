# Система аналитики «Управление затратами в системах работы с данными»

## Постановка задачи

Создание комплексной системы аналитики на основе данных внутреннего опроса сотрудников компании по управлению затратами в системах хранения и обработки данных.  
**Цель** — формирование дашбордов в Yandex DataLens для оценки прозрачности, зрелости и эффективности управления затратами между подразделениями.

**Фокус проекта:**

- **Департаменты компании** — сравнение уровня зрелости и автоматизации процессов;  
- **Типы систем** — анализ распределения затрат по технологиям;  
- **Стратегический уровень** — выявление зон оптимизации и выработка рекомендаций.

**Примечание** 
Не удалось установить прямое подключение между DataLens и PostgreSQL, размещенным на локальной виртуальной машине. 
Проверка подключения по внешнему IP возвращала ошибку "Connection refused", что указывало на сетевые ограничения (пробовал и проброс портов сделать и SSH тунель - не получилось). Ошибка на [скриншоте](screenshots/error.png)

Поэтому экспортировал необходимые таблицы из PostgreSQL в CSV файлы, которые были успешно загружены в DataLens. 
Это позволило продолжить работу с данными несмотря на сетевые ограничения. 
Соответсвено архитектура немного изменлась


## Технологический стек

- **База данных:** PostgreSQL 15+  
- **Обработка данных:** Python (pandas, psycopg2, SQLAlchemy)  
- **Аналитика и визуализация:** Yandex DataLens  
- **Среда разработки:** VS Code / Jupyter Notebook  
- **Формат данных:** CSV  

## Архитектура системы
```
CSV Data → ETL Pipeline → PostgreSQL → Data Marts → CSV Data Marts → DataLens Dashboards
```
### Основные компоненты

1. **Сырые данные (схема raw_data)**  
   Таблица `cost_management_survey` содержит результаты внутреннего опроса:  
   - Отдел и направление работы  
   - Тип используемой системы (облачная, локальная, гибридная)  
   - Уровень эффективности и зрелости управления затратами  
   - Доля затрат на хранение данных  
   - Автоматизация мониторинга  
   - Отклонение бюджета  
   - Ключевые метрики и применяемые практики  

2. **Аналитические витрины (схема analytics)**  
   - `mart_department_summary` — анализ затрат по департаментам  
   - `mart_systems_summary` — сравнение по типам используемых систем  
   - `mart_maturity_summary` — распределение по уровням зрелости управления затратами  
   - `mart_company_strategy_metrics` — стратегическая аналитика и рекомендации  

3. **DataLens Дашборды**  
   - Средняя доля затрат на хранение данных внутри департаментов  
   - Типы систем, используемые в подразделениях  
   - Уровень зрелости управления затратами  

## Шаги реализации

1. **Подготовка данных**  
   - [Экспорт ответов из Google Forms](data/survey_responses_raw.csv) 
   - [Анализ структуры и очистка (Python)](analysis/data_analysis.ipynb)  
   - Загрузка в PostgreSQL (`raw_data.cost_management_survey`)  

2. **Создание витрин данных**  
   - SQL-скрипт `sql/database_setup.sql` создаёт:  
     - Схему `raw_data` и таблицу опроса  
     - Схему `analytics` и четыре агрегированные витрины  
     - Комментарии с описанием всех колонок  
     - Проверку созданных объектов
       
3. **Выгрузка витрин данных в CSV**
     - Выгрузка витрин представлена на [скриншоте1](screenshots/exporttables.png) и [скриншоте2](screenshots/exporttables2.png) 
       
5. **Настройка Yandex DataLens**  
   - Подключение к PostgreSQL  
   - Создание датасетов на основе витрин (`mart_*`)  
   - Формирование визуализаций и чаров  

## Структура проекта

```
ЛБ_3_1/
├── analysis/
│   └── data_analysis.ipynb              # Анализ и загрузка данных в БД
├── data/
│   ├── survey_responses_raw.csv         # Сырые данные из опроса
│   ├── cost_management_survey_row_from_DB.csv
│   ├── mart_department_summary_processed.csv
│   ├── mart_maturity_summary_processed.csv
│   ├── mart_systems_summary_processed.csv
│   ├── mart_company_strategy_metrics_processed.csv
├── sql/
│   └── database_setup.sql               # Скрипт создания схем, таблиц и витрин
├── survey/
│   └── Опрос.pdf                        # Опросник для сотрудников
└── readme.md                            # Документация проекта
```

## Структура DataLens

### Дашборды: «Управление затратами в системах работы с данными»

**1. Источник:** `analytics.mart_company_strategy_metrics`  
**Ключевой график:**  
- Стрим чарт «Типы систем, используемые в подразделении»  
**Описание:** визуализирует распределение типов систем (облачная, локальная, гибридная) по подразделениям компании, позволяет выявить основные технологии и области для оптимизации затрат.  

**2. Источник:** `analytics.mart_maturity_summary`  
**Ключевой график:**  
- Стрим чарт «Уровень зрелости управления затратами»  
**Описание:** показывает распределение уровней зрелости по департаментам, помогает оценить эффективность процессов и степень автоматизации управления затратами.  

**3. Источник:** `analytics.mart_department_summary`  
**Ключевой график:**  
- Стрим чарт «Средняя доля затрат на хранение данных внутри департаментов»  
**Описание:** отображает средний процент затрат на хранение данных для каждого департамента, позволяет выявить подразделения с высоким расходом и зоны для оптимизации.  


## Документация

Подробное описание формирования витрин и рекомендации по созданию дашбордов см. в [Руководстве по формированию аналитических витрин](docs/datamarts_guide.md).
